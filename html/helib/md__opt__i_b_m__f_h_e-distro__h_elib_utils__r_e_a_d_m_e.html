<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.17"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>HElib: Utilities</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
		<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;1,700&family=Merriweather&family=Merriweather+Sans&family=Open+Sans&family=Poppins:ital@1&family=Roboto:ital,wght@0,400;1,300;1,900&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
        <script type="text/javascript" src="jquery.smartmenus.js"></script>
        <!-- SmartMenus jQuery Bootstrap Addon -->
        <script type="text/javascript" src="jquery.smartmenus.bootstrap.js"></script>
        <!-- SmartMenus jQuery plugin -->
    </head>
    <body style="font-family: 'Merriweather', serif;">
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">HElib Implementing Homomorphic Encryption</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Utilities </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md76"></a>
Introduction</h1>
<p>The <code>utils</code> directory provides utilities to make using and developing projects in HE simpler for everyone. The utility programs currently should be considered at an alpha state and not completely stable in terms of the CLI or all possible configurations.</p>
<h1><a class="anchor" id="autotoc_md77"></a>
What is provided</h1>
<p>Currently the utilities provided comprise:</p><ul>
<li>create-context</li>
<li>encrypt</li>
<li>decrypt</li>
</ul>
<p>More utilities are expected to be released at a later date.</p>
<p>When developing HE programs the encoding is of utmost importance and usually are specific to the problem domain. We provide two simple example programs for encoding and decoding:</p>
<ul>
<li>example encoder (requires python &gt;= 3.6)</li>
<li>example decoder (requires python &gt;= 3.6)</li>
</ul>
<p>These example programs are used in our testing. We used Python, however, encoders and decoders programs can be implemented in whatever language the developer wishes.</p>
<p>Some example data can be generated by the example data generation script <code>gen-data.py</code> which can be found in the <code>tests</code> directory.</p>
<h1><a class="anchor" id="autotoc_md78"></a>
Installation</h1>
<p>To compile the utilities, you must have HElib already installed on your system (see ../INSTALL.md "INSTALL.md" in this distribution's root directory). The process is pure CMake. First, create a build directory and move into it. Second, run CMake,</p>
<div class="fragment"><div class="line">cmake [-Dhelib_DIR=&lt;directory-to-installed-HElib&gt;/share/cmake/helib] &lt;directory-to-utils&gt;</div>
</div><!-- fragment --><p>then run make from the same directory with optional number of threads using the <code>-j</code> flag for example,</p>
<div class="fragment"><div class="line">make [-j&lt;number-of-threads&gt;]</div>
</div><!-- fragment --><p>The create-context, encrypt and decrypt utility executables can be found in the <code>bin</code> directory. The example encoder and decoder are found in a separate directory in <code>&lt;directory-to-utils&gt;/coders</code>.</p>
<p>All tests for the utilities are written in bats (a test framework for bash) and require <a href="https://github.com/bats-core/bats-core/releases/tag/v1.2.1">bats-core</a>.</p>
<h1><a class="anchor" id="autotoc_md79"></a>
Running the utilities</h1>
<p>All utilities have a help method by passing the <code>-h</code> flag, for example</p>
<div class="fragment"><div class="line">./encrypt -h</div>
</div><!-- fragment --><p>Below is an example of a basic pipeline for the utilities. For simplicity we shall be using the BGV scheme although the utilities also provide CKKS functionality.</p>
<ol type="1">
<li>Create a parameter file for the BGV scheme such as <div class="fragment"><div class="line">p=2</div>
<div class="line">m=3</div>
<div class="line">r=1</div>
<div class="line">c=2</div>
<div class="line">Qbits=10</div>
</div><!-- fragment --></li>
<li>Create the context using the previously generated parameter file <div class="fragment"><div class="line">./bin/create-context &lt;parameter-file&gt; --info-file -o example</div>
</div><!-- fragment --></li>
</ol>
<p>The flag <code>-o</code> defines the prefix of the files generated by this script. If not specified then the script will generate a prefix using the name of the parameter file by default concatenated with a generated number. This file prefix will be printed to the command line.</p>
<p>The script will always generate two files (<code>example.pk</code> and <code>example.sk</code>. They both hold the serialization of the context and the public key and secret key respectively.</p>
<p>The flag <code>--info-file</code> will redirect the information describing the algebra to the file <code>example.info</code>. By default this information is sent to the standard output however generating the info file is useful for passing to the example encode decode utilities.</p>
<ol type="1">
<li>Encode some data <div class="fragment"><div class="line">../coders/encode.py &lt;data-file&gt; example.info &lt;scheme&gt; &gt; example.encoded</div>
</div><!-- fragment --></li>
</ol>
<p>This script reads in data from <code>&lt;data-file&gt;</code> where the first line represents the number of lines to read in and each subsequent line contains the coefficients of each slot of the plaintext.</p>
<p>The encoder reads the algebra from the info file <code>example.info</code> to encode the data in the correct format.</p>
<p>The encoder must also be told which scheme is being used, currently scheme can be either <code>BGV</code> or <code>CKKS</code>.</p>
<p>The example encoder outputs the encoded data as plaintexts to the command line by default which is then redirected to <code>example.encoded</code>.</p>
<p>The output of the encoder is a collection of plaintexts and must be formatted as follows:</p>
<p>The first line contains the number of plaintexts outputted by the encoder. Each subsequent line contains a single plaintext.</p>
<p>Each plaintext has to be formatted as a comma-separated list surrounded by '[' and ']'. Each element of the list represents the slot of the plaintext formatted as a comma-separated list surrounded by '[' and ']'. Each element in the nested list represents the coefficient of the polynomial in the slot. Note, for the CKKS scheme, there are always a maximum of two elements in a slot of a plaintext which represent the real and imaginary values respectively.</p>
<p>An example output of encoding two plaintexts with three slots, each containing two coefficients is shown below </p><div class="fragment"><div class="line">2</div>
<div class="line">[[0, 1], [2, 3], [4, 5]]</div>
<div class="line">[[6, 7], [8, 9], [10, 11]]</div>
</div><!-- fragment --><p>Note that the encoder reads in each line and encodes the values into a slot until the maximum number of slots is reached. When this happens the encoder begins encoding another plaintext until all data values are read in. If the maximum number of slots is not reached upon reaching the end of the data file, then the remaining slots of the plaintext are padded with slots containing 0.</p>
<ol type="1">
<li>Encrypt the data <div class="fragment"><div class="line">./bin/encrypt example.pk example.encoded -o example.ctxt</div>
</div><!-- fragment --></li>
</ol>
<p>The encrypt script reads in a public key file <code>example.pk</code> and some encoded data <code>example.encoded</code>.</p>
<p>Optionally, the use of <code>-o</code> enables the user to specify the filename containing the encrypted output. By default the script generates a file using the prefix of the plaintext file and appending the extension <code>.ctxt</code>.</p>
<ol type="1">
<li>Decrypt the data <div class="fragment"><div class="line">./bin/decrypt example.sk example.ctxt -o example.decrypted</div>
</div><!-- fragment --></li>
</ol>
<p>The decrypt script reads in a secret key file <code>example.sk</code> and some encrypted data <code>example.ctxt</code>.</p>
<p>Optionally, the use of <code>-o</code> enables the user to specify the filename containing the decrypted output. By default the script will print the decrypted plaintext to the standard output.</p>
<ol type="1">
<li>Decode the data <div class="fragment"><div class="line">../coders/encode.py example.decrypted example.info &lt;scheme&gt;</div>
</div><!-- fragment --></li>
</ol>
<p>The decoder reads some encoded data <code>example.decrypted</code> and an info file <code>example.info</code> to ensure the data is decoded in the correct format.</p>
<p>The decoder must be told which scheme is being used, currently the scheme can be either <code>BGV</code> or <code>CKKS</code>.</p>
<p>The input of decoder must be formatted in the same way as the output of the encoder as described above in step 3.</p>
<p>The example decoder outputs the decoded data to the standard output by default.</p>
<h1><a class="anchor" id="autotoc_md80"></a>
Running the tests</h1>
<p>All tests for the utilities are written in bats (a test framework for bash) and require <a href="https://github.com/bats-core/bats-core">bats-core</a>.</p>
<p>Note that the tests require that the utilities have been successfully compiled in the <code>build</code> directory and available in <code>build/bin</code>. To run the tests, one can simply execute the scripts from within the <code>utils/tests</code> directory.</p>
<p>To run all tests type the command below. Optionally, the <code>-j</code> flag can use threads to parallelize the tests. Note, this requires GNU parallel, see the <a href="https://github.com/bats-core/bats-core">bats</a> documentation for more information. </p><div class="fragment"><div class="line">bats . [-j &lt;number-of-threads&gt;]</div>
</div><!-- fragment --><p>To run a specific test file. </p><div class="fragment"><div class="line">bats &lt;testfile&gt; [-j &lt;number-of-threads&gt;]</div>
</div><!-- fragment --><p>or </p><div class="fragment"><div class="line">./&lt;testfile&gt; [-j &lt;number-of-threads&gt;]</div>
</div><!-- fragment --><p>To run a specific test by name add the <code>-f</code> flag e.g. </p><div class="fragment"><div class="line">bats . -f &lt;testname&gt; [-j &lt;number-of-threads&gt;]</div>
</div><!-- fragment --><p>The <code>&lt;testname&gt;</code> can be a substring of the test name and will match all valid matches.</p>
<p>For debugging, it is sometimes useful to view the artifacts generated by the tests. For this, set the environment variable <code>DEBUG</code> to <code>true</code> or <code>1</code> such as, </p><div class="fragment"><div class="line">DEBUG=1 bats . [-j &lt;number-of-threads&gt;]</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
        <script type="text/javascript" src="doxy-boot.js"></script>
</html>
