<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.17"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>HElib: Building and running the new tests</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
		<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;1,700&family=Merriweather&family=Merriweather+Sans&family=Open+Sans&family=Poppins:ital@1&family=Roboto:ital,wght@0,400;1,300;1,900&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
        <script type="text/javascript" src="jquery.smartmenus.js"></script>
        <!-- SmartMenus jQuery Bootstrap Addon -->
        <script type="text/javascript" src="jquery.smartmenus.bootstrap.js"></script>
        <!-- SmartMenus jQuery plugin -->
    </head>
    <body style="font-family: 'Merriweather', serif;">
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">HElib Implementing Homomorphic Encryption</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Building and running the new tests </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ol type="1">
<li>To build and run the new tests, one must pass <code>-DENABLE_TEST=on</code> to cmake (see INSTALL.md). The google test library will then be downloaded and the correct targets will be defined for cmake.</li>
<li>To compile them, <code>make</code> as normal from a build directory.</li>
<li>The entire set of tests can be run with:<ul>
<li><code>./bin/runTests</code> or <code>./dependencies/Build/helib_external/bin/runTests</code> if <code>PACKAGE_BUILD=ON</code>. The parameters <code>noPrint</code>, <code>dry</code> and <code>verbose</code> can be specified as before, but they will apply to all tests which are run.</li>
<li><code>ctest</code>. In this case the output will be significantly less verbose and therefore less helpful in the case of a failure. The parameter <code>--output-on-failure</code> can be added to display the output of each test that happened to fail. It is also possible to run tests in parallel by using <code>-j&lt;number of concurrent tests&gt;</code>. Detailed output of the tests (as if run directly with <code>runTests</code>) can be found in <code>Testing/Temporary/LastTest.log</code>.</li>
<li><code>make test</code>, which will run the tests through <code>ctest</code>. In this case no arguments can be passed. Detailed output of the tests (as if run directly with <code>runTests</code>) can be found in <code>Testing/Temporary/LastTest.log</code>.</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md63"></a>
Running a subset of the tests</h1>
<p>One may often want to run a specific test or set of tests. This is achieved using google test's built-in 'filtering' system. To run only the <code>PolyEval</code> tests, for example, one simply runs </p><div class="fragment"><div class="line">./bin/runTests --gtest_filter=&#39;*PolyEval*&#39;</div>
</div><!-- fragment --><p>To list all the tests, use <code>./bin/runTests --gtest_list_tests</code>. More details on this filtering can be found in Google's documentation <a href="https://github.com/google/googletest/blob/master/googletest/docs/advanced.md#running-a-subset-of-the-tests" title="Google documentation">here</a>.</p>
<p>It is also possible to run a specific test using <code>ctest</code> by adding the argument <code>-R "&lt;name of the test&gt;"</code>. For example to run only the <code>PolyEval</code> test one simply runs </p><div class="fragment"><div class="line">ctest -R &quot;PolyEval&quot;</div>
</div><!-- fragment --><p>To list all the tests, use <code>ctest -N</code>. More details on this filtering can be found in the <code>ctest</code> documentation <code>ctest --help</code>.</p>
<h1><a class="anchor" id="autotoc_md64"></a>
Changing parameters</h1>
<p>The majority of the tests currently residing in <code>tests</code> are ported from the old tests which took several parameters. This maps reasonably well onto google test's 'Parameterised tests', more of which can be read about <a href="https://github.com/google/googletest/blob/master/googletest/docs/advanced.md#value-parameterized-tests" title="Parameterised tests">here</a>.</p>
<p>Currently, the parameters to run tests with are written in the tests themselves, and require modification in the code to run with different parameters. Some runtime overriding of these parameters would be possible by placing a function call in the <code>INSTANTIATE_TEST_CASE_P</code> macro, but this has not been done yet.</p>
<h1><a class="anchor" id="autotoc_md65"></a>
Writing new tests</h1>
<h2><a class="anchor" id="autotoc_md66"></a>
Why google test?</h2>
<p>The google test framework gives us a few of main benefits:</p>
<ul>
<li>The presence of 'fixtures', which are classes to contain common set-up and teardown code. These are created by inheriting from <code>::testing::Test</code> or <code>::testing::TestWithParam&lt;T&gt;</code>, and typically have a name such as <code>GTest_extractDigits</code>.</li>
<li>A rich set of expectation/assertion macros, such as <code>EXPECT_EQ</code>, <code>EXPECT_GT</code>, and many more which can be read about <a href="https://github.com/google/googletest/blob/master/googletest/docs/primer.md" title="expectation/assertion macros">here</a>. A test will typically contain at least one of these, the result of which determines the success or failure of the test.</li>
<li>A convenient runner which provides utilities such as filtering, repeating, shuffling, and convenient, consistent printouts. This adds significant convenience when only some tests are failing, since a summary as printed at the end specifying which tests failed, with which parameters they failed, etc.</li>
</ul>
<h2><a class="anchor" id="autotoc_md67"></a>
Summary of how to write a google test</h2>
<ol type="1">
<li>Create a new file for the tests, let's say called <code>GTest_foo.cpp</code>.</li>
<li>Add <code>GTest_foo.cpp</code> and <code>GTest_foo</code> to the appropriate lists in <code>tests/CMakeLists.txt</code>.</li>
<li>In <code>GTest_foo.cpp</code>, be sure to include both <code>"gtest/gtest.h"</code> and <code>"test_common.h</code>. The latter will give access to the parameters <code>helib_test::dry</code>, <code>helib_test::noPrint</code>, <code>helib_test::special_bits</code>, <code>helib_test::verbose</code>, and <code>helib_test::seed</code>.</li>
<li>Create an anonymous namespace in which to put everything, so that the global namespace for the test runner is not polluted.</li>
<li>Create a class called <code>GTest_foo</code>, inheriting from <code>::testing::Test</code> or <code>::testing::TestWithParam&lt;some_type&gt;</code> for non-parameterized or parameterized tests (respectively). Common setup and teardown code/data should be placed in this class.</li>
<li>Create actual test code inside a <code>TEST_F</code> or <code>TEST_P</code> for non-parameterized or parameterized tests (respectively).</li>
<li>If using parameterized tests, create some parameters to run the tests with using the <code>INSTANTIATE_TEST_CASE_P</code> macro.</li>
</ol>
<h2><a class="anchor" id="autotoc_md68"></a>
Further reading</h2>
<p>More details on how to use these google test utilities can be found by the helpful google test documentation:</p>
<ul>
<li>Basic overview: <a href="https://github.com/google/googletest/">https://github.com/google/googletest/</a></li>
<li>Introduction to using google test: <a href="https://github.com/google/googletest/blob/master/googletest/docs/primer.md">https://github.com/google/googletest/blob/master/googletest/docs/primer.md</a></li>
<li>More detailed documentation: <a href="https://github.com/google/googletest/blob/master/googletest/README.md">https://github.com/google/googletest/blob/master/googletest/README.md</a></li>
<li>Advanced features: <a href="https://github.com/google/googletest/blob/master/googletest/docs/advanced.md">https://github.com/google/googletest/blob/master/googletest/docs/advanced.md</a></li>
</ul>
<p>It may also be helpful to look at the existing examples of the above style of testing, which can be found in the <code>src/tests</code> folder. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
        <script type="text/javascript" src="doxy-boot.js"></script>
</html>
